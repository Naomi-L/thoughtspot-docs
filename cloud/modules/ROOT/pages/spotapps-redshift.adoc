= {spotapp}
:last_updated: 6/13/2022
:experimental:
:linkattrs:
:page-layout: default-cloud
:description: Deploy the {spotapp}, an out-of-the-box solution template built specifically for {application}.
:spotapp: Redshift Performance and Consumption SpotApp
:application: Redshift

include::partial$spotapps-intro.adoc[]

This is a sample Liveboard, created after you deploy the {spotapp}:

image::spotapp-redshift-liveboard.png[Redshift SpotApp Liveboard]

Use the {spotapp} to manage costs and investigate query performance. Track how and where your users consume credits, and triage and resolve any performance bottlenecks.

[#prerequisites]
== Prerequisites
Before you can deploy the {spotapp}, you must complete the following prerequisites:

include::partial$spotapp-prereqs-general.adoc[]

* Administrator access to {application}
* You must create views based on the following {application} tables in your cloud data warehouse. If you already created the views, you only need access to the views, not the tables. Refer to <<schema,{spotapp} schema>> for more details.
** pg_user
** stl_query
** stl_wlm_query
** stv_wlm_service_class_config
** svl_qlog
** stl_alert_event_log
** svv_table_info
** stv_sessions
** stl_load_errors
** stv_node_storage_capacity
** stl_ddltext
** stl_plan_info
** svl_query_metrics_summary
** svl_s3query_summary

* Access to the following {application} views in your cloud data warehouse:
** pg_user_vw
** stl_query_vw
** stl_wlm_query_vw
** stv_wlm_service_class_config_vw
** svl_qlog_vw
** stl_alert_event_log_vw
** svv_table_info_vw
** stv_sessions_vw
** stl_load_errors_vw
** stv_node_storage_capacity_vw
** stl_ddltext_vw
** stl_plan_info_vw
** svl_query_metrics_summary_vw
** svl_s3query_summary_vw
* Run the required SQL commands in your cloud data warehouse. Refer to <<sql,Run SQL commands>>.

[#sql]
=== Run SQL commands
The following SQL commands create the required views based on the required tables.

NOTE: The following SQL example is for the Redshift cloud data warehouse. You may need to modify the code for the SQL requirements of your specific cloud data warehouse.

SQL commands:
[%collapsible]
.Click on the dropdown to view the SQL commands.
====
--
include::partial$redshift-sql-script.adoc[]
--
====

include::partial$spotapp-deploy-individual.adoc[]

[#schema]
== {spotapp} schema

The following table describes the schema for the {spotapp}.

|===
| Table/View | Column | Column type | Join column | Required column

| pg_user_vw| usename | varchar | Y | Y
| pg_user_vw| usesuper| bool| N | N
| pg_user_vw| usesysid| int | Y | Y
| stl_query_vw| query | int | Y | Y
| stl_query_vw| pid | int | Y | Y
| stl_query_vw| database| varchar | N | Y
| stl_query_vw| querytxt| varchar | N | Y
| stl_query_vw| starttime | timestamp | N | N
| stl_query_vw| endtime | timestamp | N | N
| stl_query_vw| aborted | int | N | N
| stl_query_vw| userid| int | N | N
| stl_wlm_query_vw| query | int | Y | Y
| stl_wlm_query_vw| service_class | int | Y | Y
| stv_wlm_service_class_config_vw | name| varchar | N | Y
| stv_wlm_service_class_config_vw | service_class | int | Y | Y
| svl_qlog_vw | elapsed | int | N | Y
| svl_qlog_vw | query | int | Y | Y
| stl_alert_event_log_vw| query | int | Y | Y
| stl_alert_event_log_vw| event | varchar | N | Y
| stl_alert_event_log_vw| solution| varchar | N | N
| stl_alert_event_log_vw| pid | int | N | N
| stl_alert_event_log_vw| event_time| timestamp | N | N
| svv_table_info_vw | database| varchar | N | N
| svv_table_info_vw | table | varchar | N | Y
| svv_table_info_vw | size| int | N | N
| svv_table_info_vw | pct_used| numeric | N | N
| svv_table_info_vw | tbl_rows| numeric | N | Y
| stv_sessions_vw | starttime | timestamp | N | Y
| stv_sessions_vw | process | int | N | Y
| stv_sessions_vw | db_name | varchar | N | N
| stv_sessions_vw | timeout_sec | int | N | N
| stv_sessions_vw | user_name | varchar | Y | Y
| stl_load_errors_vw| query | int | N | Y
| stl_load_errors_vw| line_number | int | N | N
| stl_load_errors_vw| session | int | N | N
| stl_load_errors_vw| colname | varchar | N | N
| stl_load_errors_vw| starttime | timestamp | N | N
| stl_load_errors_vw| tbl | int | N | N
| stl_load_errors_vw| filename| varchar | N | N
| stl_load_errors_vw| err_code| int | N | N
| stl_load_errors_vw| err_reason| varchar | N | Y
| stl_load_errors_vw| userid| int | Y | Y
| stv_node_storage_capacity_vw| capacity| int | N | Y
| stv_node_storage_capacity_vw| used| int | N | Y
| stv_node_storage_capacity_vw| node| int | Y | Y
| stl_ddltext_vw| pid | int | Y | Y
| stl_plan_info_vw| nodeid| int | Y | Y
| stl_plan_info_vw| query | int | Y | Y
| svl_query_metrics_summary_vw| query | int | Y | Y
| svl_s3query_summary_vw| query | int | Y | Y

|===