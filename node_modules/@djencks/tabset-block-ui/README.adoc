= {extension}-ui ui bundle extension
:extension: tabset-block
:extension-version: 0.0.3

== Description

This ui bundle extension provides behavior and styling for the `@djencks/asciidoctor-tabset-block` extension.
It originated with Dan Allen's implementation for CouchBase at https://github.com/couchbase/docs-ui-sandbox/blob/archive/src/js/05-tabsetet.js[] and (the end of) https://github.com/couchbase/docs-ui-sandbox/blob/archive/src/css/doc.css[].
The main initial changes were greater use of variables and alignment of variables with the Antora default UI variable names.

In comparison with the Couchbase original, the related asciidoctor extension and this UI provide support for nested tabsets and full support for links to tabs, including nested tabs.
Nested tabsets are inconsistent with the default Antora fragment-jumper, which assumes that at the time of a click, the link target is visible.
To support nested tabsets, the fragment-jumper has been rewritten to use the hashchange event, and a general mechanism for specifying a specific scroll location or target element provided.
A javascript addition needs to be run before the fragment jumper, so it gets an opportunity to respond to the hashchange event before the fragment-jumper scrolls.

This project is set up to use the experimental UI composition/extension mechanism from `@djencks/antora-ui-builder`.
Alternatively, this source can be copied into a UI project based on the Antora default UI.

At the moment, since this project replaces `src/js/03-fragment-jumper`, this cannot readily be set up as a supplemental_files ui modification.

== Usage

To build a ui bundle based on the antora-ui-default sources with the additions from this extension, run `gulp`.

To combine the UI elements from this extension with other elements, using `@djencks/antora-ui-builder`, include in your antora-ui.yml a clause such as:

[source,yml,subs="+attributes]
---
sources:
  - path: antora-ui-default #replace or extend as needed
  - path: @djencks/{extension}-ui
---

Set up your UI project as a ui builder project and include in the `package.json`

[source,json,subs="+attributes"]
---
{
  "name": "...",
  "version": "...",
  "description": "...",
  "main": "gulpfile.js",
  "files": [
    "src/**/*",
    "build/**/*"
  ],
  "devDependencies": {
    "@djencks/antora-ui-builder": "https://experimental-repo.s3-us-west-1.amazonaws.com/djencks-antora-ui-builder-v0.0.1.tgz",
    "@antora/antora-ui-default": "git+https://gitlab.com/antora/antora-ui-default.git"
    "@djencks/{extension}-ui": "https://experimental-repo.s3-us-west-1.amazonaws.com/djencks-{extension}-ui-v{extension-version}.tgz"
  }
}
---

Finally, run `gulp`.

See the example in https://gitlab.com/djencks/simple-examples[].

== Design comments

Support for nested tabsets and links to tabs involves making links to elements that are hidden work properly.
Two substantial changes to the Antora default UI fragment-jumper are needed:

* The major actions of fragment-jumper are taken in a hashchange listener rather than a click listener.
* Communication from other bits of javascript to the fragment jumper is needed, to tell the fragment-jumper where to go.
** Explicit scrollY value is needed so clicking on a tab doesn't scroll.
** Explicit target element is needed so the entire tab remains visible rather than just the link target of the label.
Scrolling to the link target results in clipping off the top of the tab.

Currently the communication is implemented in a `fragmentJumper` field added to `window.location`.
Once used by fragment-jumper, it is removed. The used and recognized values are:

* `window.location.fragmentJumper = { scrollY: window.scrollY }`
* `window.location.fragmentJumper = { target: tabInfo.tab }`

Presumably this communication channel and modifications to fragment-jumper can be used to implement other features such as collapsible sections.
