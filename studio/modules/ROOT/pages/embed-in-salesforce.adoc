= Embedding a Report in Salesforce
:categories: ["Embedding"]
:categories_weight: 40
:date: 2018-05-17
:description: How to embed a Mode report in Salesforce as a Visualforce page.
:ogdescription: How to embed a Mode report in Salesforce as a Visualforce page.
:path: /articles/embed-in-salesforce
:brand: Mode

== Overview

A {brand} Report can be embedded into a Salesforce page layout as a VisualForce page.
The embed can be configured so that the underlying {brand} Report refreshes whenever the page layout is loaded in Salesforce. The Report can be run with Parameters that are derived from Salesforce objects (for example, a customer ID).

For example:

image::salesforce-embed.png[Embed Mode Reports in Salesforce]

== Requirements

In order to follow the steps in this guide, the following requirements must be met:

* You must have permissions in Salesforce to create VisualForce objects, change page layouts, and access the setup page.
* The {brand} Workspace containing the target report must be on a link:https://mode.com/compare-plans/[paid plan,window=_blank].
* Embed viewers must be logged in to {brand}, must be members of the {brand} Workspace containing the embedded Report, and must have access to the embedded Report.
+
NOTE: The exact steps outlined in this guide assume you are using the Salesforce Classic interface. You may embed a {brand} Report using the Salesforce Lightning interface, but the steps below may vary.

== Implementation steps

=== Prepare the Report

Begin by creating a Report in {brand} that displays the data you want to embed inside of Salesforce.

If you want the Report to display different output depending on the context in which the embed is viewed in Salesforce, xref:parameters.adoc[add Parameters].
In the example below, we use a Parameter called `organization_id`, which represents the unique id of a customer as stored in our internal database.
The `organization_id` corresponding to each customer is stored in Salesforce on the Account object in the custom field `OrganizationAccountID__c`.

Whenever the page layout containing the embed loads, Salesforce will provide the embed with the value of `OrganizationAccountID__c` for the corresponding Account.
Then the underlying Report will run with that value and the embed will render the results for that Account.

=== Construct an embed URL

Take the URL of the Report and add `/embed` to the end of the URL path, for example:

[source,http]
----
<!-- Report URL (always shows latest run) -->
https://app.mode.com/[ORG_NAME]/reports/[REPORT_TOKEN]/embed
                                                           ^^^^^^
----

TIP: In most cases, you will want to use a standard report link and *not* a static run link when embedding a Report in Salesforce. xref:report-scheduling-and-sharing.adoc#link[Learn more about the difference between a report link and static run link].

Now add a xref:report-layout-and-presentation.adoc#url-query-string[query string] to the Report URL to control any Parameters defined in the Report.

[NOTE]
====
* A field-value pair must be provided for each Report xref:parameters.adoc[Parameter] (if any are defined) or the embed will not render.
* For Parameters with dynamic values based on the context in which the embed is viewed, use a link:https://trailhead.salesforce.com/en/modules/visualforce_fundamentals/units/visualforce_variables_expressions[Visualforce Expression,window=_blank] in the URL.
For example, `{!Account.OrganizationAccountID\__c}` would return the value in the `OrganizationAccountID__c` custom field on the Account object.
* Ensure you link:https://developer.salesforce.com/docs/atlas.en-us.apexcode.meta/apexcode/apex_classes_restful_encodingUtil.htm[URL-encode,window=_blank] any Parameter values with special characters (if necessary).
====

Finally, include `run=now` in the xref:report-layout-and-presentation.adoc#url-query-string[query string] to ensure the embedded Report's data is refreshed whenever the embed is viewed in Salesforce.
Your embed URL should look like the following:

[source,html]
----
<!-- Embed URL - General Format -->
https://app.mode.com/[ORG_NAME]/reports/[REPORT_TOKEN]/embed?run=now&param_[PARAM_NAME]={![SF_OBJECT_NAME].[SF_FIELD_NAME]}

<!-- Embed URL - Example -->
https://app.mode.com/octan/reports/2277bhs889d5/embed?run=now&param_organization_id={!Account.OrganizationAccountID__c}
----

=== Define the Visualforce Page

. Click *Setup* next to your name in the upper right corner.
On the left side under *Build* \-> *Develop*, click *Visualforce Pages*.
. All Visualforce Pages currently defined in your Salesforce instance will be listed.
Click the *New* button at the top of the list.
. In the Label field, enter a unique name for your Visualforce Page.
Under Visualforce Markup, replace the template code with the following code, with the embed URL you created in the previous step and the `standardController` property of the `<apex:page>` set to the name of the relevant Salesforce object:
+
[source,html]
----
<!-- Visualforce Markup - General Format -->
<apex:page standardController="[SF_OBJECT_NAME]">
<apex:iframe src="https://app.mode.com/[ORG_NAME]/reports/[REPORT_TOKEN]/embed?run=now&param_[PARAM_NAME]={![SF_OBJECT_NAME].[SF_FIELD_NAME]}"
    scrolling="true"
    frameborder="0"
    />
</apex:page>

<!-- Visualforce Markup - Example -->
<apex:page standardController="Account">
<apex:iframe src="https://app.mode.com/octan/reports/2277bhs889d5/embed?run=now&param_organization_id={!Account.OrganizationAccountID__c}"
    scrolling="true"
    frameborder="0"
    />
</apex:page>
----

IMPORTANT: Depending on the security settings of users in your Salesforce organization, you may need to grant access to the Visualforce Page you just created to certain user profiles. Learn more about link:https://help.salesforce.com/articleView?id=pages_page_level_security.htm&type=5[Visualforce Page Security,window=_blank].

=== Add the Visualforce Page to your desired object's page layout

. Within setup, find and edit the page layout where you want the embed to show (for example, *Build \-> Customize \-> Accounts \-> Page Layouts*).
. At the top of the page layout editor, there is a box on the left with a bunch of options for things you can add to your page layout.
Select *Visualforce Pages*.
. Create a new section on the page layout by dragging the `Section` item onto the layout where you want the embed to appear.
In the popup, give the new section a name (for example, Customer Stats), select *1 column*, and click *OK*.
. In the same box where you found `Section`, you will find the VisualForce page you created.
Drag it into the Section you just added to the layout.
. Edit the properties on the Visualforce Object (not the Section) by hovering on it and clicking the *wrench*  icon in the upper right.
Change the width and height to your liking.

Your report should now render inside the Visualforce Page every time the corresponding page layout is viewed in Salesforce.
